<div class="form-container">
  <div class="form-header">
    <h1>{{ isEditMode ? 'Editar Filial' : 'Nova Filial' }}</h1>
  </div>

  <app-loading *ngIf="loading"></app-loading>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <form [formGroup]="filialForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <div class="form-group">
      <label for="nome">Nome da Filial *</label>
      <input
        type="text"
        id="nome"
        formControlName="nome"
        class="form-control"
        [class.is-invalid]="nome?.invalid && nome?.touched"
      />
      <div class="invalid-feedback" *ngIf="nome?.invalid && nome?.touched">
        <span *ngIf="nome?.errors?.['required']">Nome é obrigatório</span>
        <span *ngIf="nome?.errors?.['minlength']">Nome deve ter no mínimo 3 caracteres</span>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="cidade">Cidade *</label>
        <input
          type="text"
          id="cidade"
          formControlName="cidade"
          class="form-control"
          [class.is-invalid]="cidade?.invalid && cidade?.touched"
        />
        <div class="invalid-feedback" *ngIf="cidade?.invalid && cidade?.touched">
          <span *ngIf="cidade?.errors?.['required']">Cidade é obrigatória</span>
          <span *ngIf="cidade?.errors?.['minlength']">Cidade deve ter no mínimo 2 caracteres</span>
        </div>
      </div>

      <div class="form-group">
        <label for="estado">Estado (UF) *</label>
        <input
          type="text"
          id="estado"
          formControlName="estado"
          class="form-control"
          maxlength="2"
          [class.is-invalid]="estado?.invalid && estado?.touched"
          placeholder="Ex: SP"
        />
        <div class="invalid-feedback" *ngIf="estado?.invalid && estado?.touched">
          <span *ngIf="estado?.errors?.['required']">Estado é obrigatório</span>
          <span *ngIf="estado?.errors?.['minlength'] || estado?.errors?.['maxlength']">
            Estado deve ter 2 caracteres
          </span>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="endereco">Endereço</label>
      <input
        type="text"
        id="endereco"
        formControlName="endereco"
        class="form-control"
        placeholder="Rua, número, complemento"
      />
    </div>

    <div class="form-group">
      <label for="telefone">Telefone</label>
      <input
        type="text"
        id="telefone"
        formControlName="telefone"
        class="form-control"
        [class.is-invalid]="telefone?.invalid && telefone?.touched"
        placeholder="(99) 99999-9999"
      />
      <div class="invalid-feedback" *ngIf="telefone?.invalid && telefone?.touched">
        <span *ngIf="telefone?.errors?.['pattern']">
          Telefone deve estar no formato (99) 99999-9999
        </span>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="loading || filialForm.invalid">
        {{ isEditMode ? 'Atualizar' : 'Criar' }}
      </button>
    </div>
  </form>
</div>
